
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.HashMap;

public class HashMapFile <K, V>{

	private String fileName;
	private FileOutputStream fop;
	private ObjectOutputStream oop;
	private FileInputStream fis;
	private ObjectInputStream ois;  // Le file de objetos 
	//private EstoqueFile testeMaps;
	
	HashMapFile(String fileName){
		this.fileName = fileName;
	}
	
	void writeMap(HashMap<K, V> map) {
		try 
		{
			fop = new FileOutputStream(new File(fileName));
			oop = new ObjectOutputStream(fop);
			oop.writeObject(map);
			System.out.println("Objeto escrito com sucesso!");
		} 
		catch (FileNotFoundException e) {
			e.printStackTrace();
		} 
		catch (IOException e) {
			e.printStackTrace();
		}
		finally {
			if(oop != null) {
				try {
					oop.close();
				} catch(IOException e) {
					e.printStackTrace();
				}
			}
		}
	}
	
	HashMap<K, V> readMap() {
		try
		{
			fis = new FileInputStream(new File(this.fileName));
			ois = new ObjectInputStream(fis);
			HashMap<K, V> readObject = (HashMap<K, V>) ois.readObject();
			return readObject;
		}
		catch(FileNotFoundException fn) {
			
		} catch (IOException e) {
			e.printStackTrace();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}
		System.err.printf("deu ruim");
		return null;
	}
	
	public static void main(String[]args) {
		HashMapFile<String, Produto[]> test = new HashMapFile<String, Produto[]>("produtos.ser");
		
		HashMap<String, Produto[]> mapTest = new HashMap<String, Produto[]>();
		
		Produto p = new Produto("prodTeste");
		Produto[] array = new Produto[10];
		array[0] = p;
		mapTest.put("catTeste", array);
		
		test.writeMap(mapTest);
		System.out.println(test.readMap().get("catTeste"));
		Produto[] s = test.readMap().get("catTeste");
		System.out.println(s[0].getName());
	}

}
